Perfect! The fix is complete and all tests are passing. Let me create a summary:

## Summary

I've successfully fixed the issue where the `--mbed-os-path` option was not being passed to the config processing tool.

### Problem
The `--mbed-os-path` option was being passed to `MbedProgram.from_existing()` but the config processing tool (`assemble_config`) only searched for `mbed_lib.json` files in the program root directory. This caused issues when mbed-os was outside the project root, such as in Greentea test scenarios where the test "project root" is a subdirectory of `mbed-os`.

### Solution
Made two key changes:

1. **Updated `assemble_config()`** in `/testbed/src/mbed_tools/build/_internal/config/assemble_build_config.py`:
   - Added an optional `mbed_os_directory` parameter to allow searching for mbed_lib.json files in both the program directory and mbed-os directory
   - Added duplicate removal logic to handle cases where mbed-os might be inside the program root

2. **Updated `generate_config()`** in `/testbed/src/mbed_tools/build/config.py`:
   - Pass `program.mbed_os.root` to `assemble_config()` so it can search for config files in mbed-os

### Backward Compatibility
The fix is fully backward compatible because the `mbed_os_directory` parameter is optional with a default value of `None`. When not provided, the function behaves exactly as before.

### Testing
All tests pass successfully:
- 130 tests in the config-related test suite
- 127 tests in the build test suite  
- 7 tests in the Mbed project test suite
- All regression tests
=== GIT DIFF ===
diff --git a/src/mbed_tools/build/_internal/config/assemble_build_config.py b/src/mbed_tools/build/_internal/config/assemble_build_config.py
index 805a6d0..44cf0e0 100644
--- a/src/mbed_tools/build/_internal/config/assemble_build_config.py
+++ b/src/mbed_tools/build/_internal/config/assemble_build_config.py
@@ -12,11 +12,11 @@ from mbed_tools.build._internal.config import source
 from mbed_tools.build._internal.find_files import LabelFilter, RequiresFilter, filter_files, find_files
 
 
-def assemble_config(target_attributes: dict, mbed_program_directory: Path, mbed_app_file: Optional[Path]) -> Config:
+def assemble_config(target_attributes: dict, mbed_program_directory: Path, mbed_app_file: Optional[Path], mbed_os_directory: Optional[Path] = None) -> Config:
     """Assemble config for given target and program directory.
 
     Mbed library and application specific config parameters are parsed from mbed_lib.json and mbed_app.json files
-    located in the project source tree.
+    located in the project source tree and optionally in the mbed-os directory.
     The config files contain sets of "labels" which correspond to directory names in the mbed-os source tree. These
     labels are used to determine which mbed_lib.json files to include in the final configuration.
 
@@ -26,7 +26,11 @@ def assemble_config(target_attributes: dict, mbed_program_directory: Path, mbed_
     Then we parse all the required mbed_lib config and finally apply the app overrides.
     """
     mbed_lib_files = find_files("mbed_lib.json", mbed_program_directory)
-    return _assemble_config_from_sources(target_attributes, mbed_lib_files, mbed_app_file)
+    if mbed_os_directory:
+        mbed_lib_files.extend(find_files("mbed_lib.json", mbed_os_directory))
+    # Remove duplicates by using file paths as keys
+    unique_mbed_lib_files = list({file.resolve(): file for file in mbed_lib_files}.values())
+    return _assemble_config_from_sources(target_attributes, unique_mbed_lib_files, mbed_app_file)
 
 
 def _assemble_config_from_sources(
diff --git a/src/mbed_tools/build/config.py b/src/mbed_tools/build/config.py
index 90a1a77..73a097e 100644
--- a/src/mbed_tools/build/config.py
+++ b/src/mbed_tools/build/config.py
@@ -31,7 +31,7 @@ def generate_config(target_name: str, toolchain: str, program: MbedProgram) -> p
     """
     targets_data = _load_raw_targets_data(program)
     target_build_attributes = get_target_by_name(target_name, targets_data)
-    config = assemble_config(target_build_attributes, program.root, program.files.app_config_file)
+    config = assemble_config(target_build_attributes, program.root, program.files.app_config_file, program.mbed_os.root)
     cmake_file_contents = render_mbed_config_cmake_template(
         target_name=target_name, config=config, toolchain_name=toolchain,
     )
=== DISK USAGE ===
8	/testbed
