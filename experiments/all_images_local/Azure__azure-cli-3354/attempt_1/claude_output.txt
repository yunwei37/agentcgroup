## Summary

I successfully fixed the `az vm open-port` issue. The problem was that the code used `os.path.split()` to extract resource names from Azure resource IDs, which doesn't work correctly for resource IDs containing forward slashes.

**Root Cause:**
- `os.path.split()` treats forward slashes as path separators
- Azure resource IDs use `/` as a separator (e.g., `/subscriptions/.../resourceGroups/.../networkSecurityGroups/...`)
- This caused incorrect extraction of NIC and NSG names, resulting in a 404 error

**Fix Applied:**
Replaced `os.path.split(id)[1]` with `parse_resource_id(id)['name']` in 3 locations:

1. `custom.py:1180` - Extract NIC name from resource ID
2. `custom.py:1208` - Extract NSG name from resource ID  
3. `test_vm_commands.py:99` - Extract NSG name in test

**Git Diff:**
```diff
diff --git a/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py b/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
index 5c48d6656..425931aa6 100644
--- a/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
+++ b/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
@@ -1177,7 +1177,8 @@ def vm_open_port(resource_group_name, vm_name, port, priority=900, network_secur
         raise CLIError("No NIC associated with VM '{}'".format(vm_name))
 
     # get existing NSG or create a new one
-    nic = network.network_interfaces.get(resource_group_name, os.path.split(nic_ids[0].id)[1])
+    nic_name = parse_resource_id(nic_ids[0].id)['name']
+    nic = network.network_interfaces.get(resource_group_name, nic_name)
     if not apply_to_subnet:
         nsg = nic.network_security_group
     else:
@@ -1204,7 +1205,7 @@ def vm_open_port(resource_group_name, vm_name, port, priority=900, network_secur
     rule = SecurityRule(protocol='*', access='allow', direction='inbound', name=rule_name,
                         source_port_range='*', destination_port_range=port, priority=priority,
                         source_address_prefix='*', destination_address_prefix='*')
-    nsg_name = nsg.name or os.path.split(nsg.id)[1]
+    nsg_name = nsg.name or parse_resource_id(nsg.id)['name']
     LongRunningOperation('Adding security rule')(
         network.security_rules.create_or_update(
             resource_group_name, nsg_name, rule_name, rule)
diff --git a/src/command_modules/azure-cli-vm/tests/test_vm_commands.py b/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
index 04b61dfbe..244404864 100644
--- a/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
+++ b/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
@@ -96,7 +96,7 @@ class VMOpenPortTest(ResourceGroupVCRTestBase):
 
         # min params - apply to existing NIC (updates existing NSG)
         nsg_id = self.cmd('vm open-port -g {} -n {} --port * --priority 900'.format(rg, vm))['networkSecurityGroup']['id']
-        nsg_name = os.path.split(nsg_id)[1]
+        nsg_name = parse_resource_id(nsg_id)['name']
         self.cmd('network nsg show -g {} -n {}'.format(rg, nsg_name),
                  checks=JMESPathCheck("length(securityRules[?name == 'open-port-all'])", 1))
```

The fix ensures that Azure resource IDs are properly parsed to extract resource names, resolving the 404 "Not Found" error when running `az vm open-port`.
=== GIT DIFF ===
diff --git a/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py b/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
index 5c48d6656..425931aa6 100644
--- a/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
+++ b/src/command_modules/azure-cli-vm/azure/cli/command_modules/vm/custom.py
@@ -1177,7 +1177,8 @@ def vm_open_port(resource_group_name, vm_name, port, priority=900, network_secur
         raise CLIError("No NIC associated with VM '{}'".format(vm_name))
 
     # get existing NSG or create a new one
-    nic = network.network_interfaces.get(resource_group_name, os.path.split(nic_ids[0].id)[1])
+    nic_name = parse_resource_id(nic_ids[0].id)['name']
+    nic = network.network_interfaces.get(resource_group_name, nic_name)
     if not apply_to_subnet:
         nsg = nic.network_security_group
     else:
@@ -1204,7 +1205,7 @@ def vm_open_port(resource_group_name, vm_name, port, priority=900, network_secur
     rule = SecurityRule(protocol='*', access='allow', direction='inbound', name=rule_name,
                         source_port_range='*', destination_port_range=port, priority=priority,
                         source_address_prefix='*', destination_address_prefix='*')
-    nsg_name = nsg.name or os.path.split(nsg.id)[1]
+    nsg_name = nsg.name or parse_resource_id(nsg.id)['name']
     LongRunningOperation('Adding security rule')(
         network.security_rules.create_or_update(
             resource_group_name, nsg_name, rule_name, rule)
diff --git a/src/command_modules/azure-cli-vm/tests/test_vm_commands.py b/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
index 04b61dfbe..244404864 100644
--- a/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
+++ b/src/command_modules/azure-cli-vm/tests/test_vm_commands.py
@@ -96,7 +96,7 @@ class VMOpenPortTest(ResourceGroupVCRTestBase):
 
         # min params - apply to existing NIC (updates existing NSG)
         nsg_id = self.cmd('vm open-port -g {} -n {} --port * --priority 900'.format(rg, vm))['networkSecurityGroup']['id']
-        nsg_name = os.path.split(nsg_id)[1]
+        nsg_name = parse_resource_id(nsg_id)['name']
         self.cmd('network nsg show -g {} -n {}'.format(rg, nsg_name),
                  checks=JMESPathCheck("length(securityRules[?name == 'open-port-all'])", 1))
 
=== DISK USAGE ===
751	/testbed
