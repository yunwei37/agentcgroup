Perfect! The fix has been successfully implemented and verified. Let me create a final summary:

## Summary

Fixed the issue where square brackets `[]` in query parameters were being incorrectly URL-encoded as `%5B%5D` in httpx versions 0.23.2 and later.

### Root Cause
The `urlparse` function in `httpx/_urlparse.py` was encoding query strings with safe characters `/?`, but square brackets (which are commonly used for array notation like `arr[]=1`) were not included.

### Changes Made
Modified `/testbed/httpx/_urlparse.py`:

1. **Line 258**: Added `[]` to safe characters when encoding query strings
   - Changed from: `quote(query, safe=SUB_DELIMS + "/?")`
   - Changed to: `quote(query, safe=SUB_DELIMS + "/?[]")`

2. **Line 455**: Added `[]` to safe characters in the `urlencode` function
   - Changed from: `quote(k) + "=" + quote(v)`
   - Changed to: `quote(k, safe="/[]") + "=" + quote(v, safe="/[]")`

### Verification
✓ The exact issue scenario now works: `/?arr[]=1&arr[]=2` remains unencoded  
✓ All 248 URL and content tests pass  
✓ Regular URL encoding still works for other unsafe characters  
✓ Complex nested brackets are preserved: `key[0]=value1&key[subkey]=value3`  
✓ Square brackets are correctly preserved in both URL string and raw_path  

The fix is minimal, targeted, and maintains backward compatibility while resolving the reported issue.
=== GIT DIFF ===
diff --git a/httpx/_urlparse.py b/httpx/_urlparse.py
index 5ee6e58..33258b9 100644
--- a/httpx/_urlparse.py
+++ b/httpx/_urlparse.py
@@ -255,7 +255,7 @@ def urlparse(url: str = "", **kwargs: typing.Optional[str]) -> ParseResult:
 
     parsed_path: str = quote(path, safe=SUB_DELIMS + ":@/")
     parsed_query: typing.Optional[str] = (
-        None if query is None else quote(query, safe=SUB_DELIMS + "/?")
+        None if query is None else quote(query, safe=SUB_DELIMS + "/?[]")
     )
     parsed_fragment: typing.Optional[str] = (
         None if fragment is None else quote(fragment, safe=SUB_DELIMS + "/?")
@@ -452,4 +452,4 @@ def urlencode(items: typing.List[typing.Tuple[str, str]]) -> str:
     #
     # See https://github.com/encode/httpx/issues/2536 and
     # https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlencode
-    return "&".join([quote(k) + "=" + quote(v) for k, v in items])
+    return "&".join([quote(k, safe="/[]") + "=" + quote(v, safe="/[]") for k, v in items])
=== DISK USAGE ===
14	/testbed
