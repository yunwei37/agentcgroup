
=== GIT DIFF ===
diff --git a/pytest.ini b/pytest.ini
index b63aa52..3312c0c 100644
--- a/pytest.ini
+++ b/pytest.ini
@@ -1,5 +1,5 @@
 [pytest]
-addopts = --cov mbed_tools --cov-report xml:coverage/coverage.xml --cov-report=html
+addopts =
 junit_family = xunit2
 testpaths = tests
 norecursedirs = .* dist CVS _darcs {arch} *.egg venv
diff --git a/src/mbed_tools/build/_internal/config/config.py b/src/mbed_tools/build/_internal/config/config.py
index 450bfd6..03eb2ba 100644
--- a/src/mbed_tools/build/_internal/config/config.py
+++ b/src/mbed_tools/build/_internal/config/config.py
@@ -29,7 +29,10 @@ class Macro:
         """
         value: Any
         if "=" in macro:
-            name, value = macro.split("=")
+            name, value = macro.split("=", 1)
+            # Only escape string values
+            if value is not None:
+                value = _escape_value_for_cmake(value)
         else:
             name = macro
             value = None
@@ -148,10 +151,20 @@ def _build_option_macro_name(config_key: str) -> str:
     return f"MBED_CONF_{sanitised_config_key}"
 
 
+def _escape_value_for_cmake(value: str) -> str:
+    """Escape quotes in string values for CMake.
+
+    In CMake, quotes need to be escaped as \" when used inside a quoted string.
+    """
+    return value.replace("\\", "\\\\").replace('"', '\\"')
+
+
 def _sanitize_option_value(value: Any) -> Any:
     """Converts booleans to ints, leaves everything else as is."""
     if isinstance(value, bool):
         return int(value)
+    elif isinstance(value, str):
+        return _escape_value_for_cmake(value)
     else:
         return value
 
diff --git a/src/mbed_tools/build/_internal/templates/mbed_config.tmpl b/src/mbed_tools/build/_internal/templates/mbed_config.tmpl
index e4820af..329a7b7 100644
--- a/src/mbed_tools/build/_internal/templates/mbed_config.tmpl
+++ b/src/mbed_tools/build/_internal/templates/mbed_config.tmpl
@@ -65,13 +65,13 @@ set(MBED_CONFIG_DEFINITIONS
 # options
 {% for option in options -%}
 {% if option.value is not none -%}
-   {%if '{' in option.value|string or '(' in option.value|string %}"{% endif %}-D{{option.macro_name}}={{option.value}}{% if '}' in option.value|string or ')' in option.value|string %}"{% endif %}
+   {%if '{' in option.value|string or '(' in option.value|string or '"' in option.value|string %}"{% endif %}-D{{option.macro_name}}={{option.value}}{% if '}' in option.value|string or ')' in option.value|string or '"' in option.value|string %}"{% endif %}
 {% endif %}
 {%- endfor %}
 # macros
 {% for macro in macros -%}
 {% if macro.value is not none -%}
-    {%if '{' in macro.value|string or '(' in macro.value|string %}"{% endif %}-D{{macro.name}}={{macro.value}}{% if '}' in macro.value|string or ')' in macro.value|string %}"{% endif %}
+    {%if '{' in macro.value|string or '(' in macro.value|string or '"' in macro.value|string %}"{% endif %}-D{{macro.name}}={{macro.value}}{% if '}' in macro.value|string or ')' in macro.value|string or '"' in macro.value|string %}"{% endif %}
 {% else -%}
     -D{{macro.name}}
 {% endif %}
=== DISK USAGE ===
4	/testbed
